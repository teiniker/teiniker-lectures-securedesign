# Example: SpringBoot REST + JPA

## Setup

Make sure the MariaDB database is running: 
```Bash
$ sudo systemctl start mariadb.service 
```

If we start the MySQL client, wie can monitor the database content:
```
$ mysql -ustudent -pstudent
MariaDB [(none)]> use testdb;

# Review generated table
MariaDB [testdb]> show tables;
MariaDB [testdb]> select * from book;	
```

We can start the service as a separate process:
```Bash
$ mvn spring-boot:run
```

## Accessing the API via curl

### Insert Books
```Bash
$ curl -X POST http://localhost:8080/api/books  -H "Content-Type: application/json" -d '{"author":"Joshua Bloch","title":"Effective Java","isbn":"978-0134685991"}'
$ curl -X POST http://localhost:8080/api/books  -H "Content-Type: application/json" -d '{"author":"Robert C. Martin","title":"Clean Code","isbn":"978-0132350884"}'
$ curl -X POST http://localhost:8080/api/books  -H "Content-Type: application/json" -d '{"author":"Martin Fowler","title":"Refactoring","isbn":"978-0134757599"}'
```

### Find Books

```Bash
$ curl -i http://localhost:8080/api/books
```

```Bash
$ curl -i http://localhost:8080/api/books/3

HTTP/1.1 200 
Content-Type: application/json
Transfer-Encoding: chunked
Date: Sun, 09 Feb 2025 09:54:02 GMT

{
    "id":3,
    "author":"Martin Fowler",
    "title":"Refactoring",
    "isbn":"978-0134757599"
}
```

### Update a Book

```Bash
$ curl -i -X PUT http://localhost:8080/api/books/3  -H "Content-Type: application/json" -d '{"id":3,"author":"Martin Fowler","title":"Refactoring Existing Code","isbn":"978-0134757599"}'

HTTP/1.1 200 
Content-Type: application/json
Transfer-Encoding: chunked
Date: Sun, 09 Feb 2025 09:51:26 GMT

{
    "id":3,
    "author":"Martin Fowler",
    "title":"Refactoring Existing Code",
    "isbn":"978-0134757599"
}
```


### Delete a Book

```Bash
$ curl -i -X DELETE http://localhost:8080/api/books/2

HTTP/1.1 200 
Content-Length: 0
Date: Sun, 09 Feb 2025 09:53:13 GMT
```

## Implementation Details

### Application Configuration 

The following `application.properties`file configures a Spring Boot REST 
service that uses **JPA/Hibernate with MariaDB**:

```bash 
# Datasource configuration for MariaDB
spring.datasource.url=jdbc:mariadb://localhost:3306/testdb
spring.datasource.username=student
spring.datasource.password=student

# JPA & Hibernate configuration
spring.jpa.database-platform=org.hibernate.dialect.MariaDBDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
```

* **Datasource (MariaDB connection)**

    - **spring.datasource.url**: 
        - JDBC URL telling Spring Boot where the database is.
        - Connects to MariaDB on localhost, port 3306, database testdb.

    - **spring.datasource.username** and **spring.datasource.password**:
        Credentials Spring uses to authenticate to the database.

    Spring Boot uses these configurations to auto-configure a **DataSource bean**, 
    which JPA/Hibernate will use for all DB access.

* **JPA & Hibernate configuration**
    - **spring.jpa.database-platform**: 
        - Tells Hibernate which SQL dialect to use (MariaDB-specific SQL 
        features, data types, etc.).
        - Helps Hibernate generate correct SQL for MariaDB.

    - **spring.jpa.hibernate.ddl-auto**: Controls schema generation behavior
        - **none**: Do nothing
        - **update**: Hibernate will try to update the DB schema automatically 
        to match your entity classes (add tables/columns as needed).
        - **validate**: Check schema matches entities
        - **create**: Drop/create on startup
        - **create-drop**: Create then drop on shutdown.

* **SQL logging**
    - **spring.jpa.show-sql**: Prints SQL statements generated by Hibernate 
    to the console/log.

    - **spring.jpa.properties.hibernate.format_sql**: Pretty-prints SQL 
        (adds line breaks/indentation) to make it easier to read.

    - **logging.level.org.hibernate.type.descriptor.sql.BasicBinder**:
        - Logs bound parameter values (the actual values used for `?`
         placeholders in prepared statements).
        - Very helpful for debugging, but can expose sensitive data in 
        logs, so be careful outside dev.        


### Entity 

The `Book` class is now a JPA Entity meaning it **represents a row in 
a database table** and is managed by Hibernate.

```Java
@Entity
@Table(name = "books")
public class Book implements Serializable
{
    private static final long serialVersionUID = 1L;

    Book()
    {
    }

    @Id
    private long id;

    private String author;

    private String title;

    private String isbn;

    //...
}
```

* **Serializable**: Not required for JPA anymore in most setups, but still commonly used.

* **@Entity**: Tells JPA/Hibernate: this class is persistable and 
    should be mapped to a database table.

* **@Table(name = "books")**: Explicitly maps the entity to the 
    table named `books` (instead of relying on defaults).

* **@Id**: Marks id as the primary key column.

* **@GeneratedValue(strategy = GenerationType.IDENTITY)**: 
    Delegates ID creation to the database (typical for MariaDB/MySQL).

* **Default Constructor**: JPA requires a **no-arg constructor** (at 
    least protected or public) so Hibernate can instantiate the 
    entity via reflection. 


### Repository 

The following interface defines the **persistence layer** of our REST 
service using **Spring Data JPA**. It allows us to interact with the 
`Book` entity in the database without writing any SQL or implementation 
code.

```Java
public interface BookRepository extends JpaRepository<Book, Long>
{
    // Additional query methods (if needed) can be defined here.
}
```

* **JpaRepository<Book, Long>**: By extending `JpaRepository`, Spring 
    Data automatically provides a **fully implemented repository at runtime**.
    We do not implement this interface yourself.
    - `Book`: The JPA entity this repository manages
    - `Long`: The type of the entityâ€™s primary key

* **CRUD operations** we get for free: 
    - `findAll()`: Retrieves all `Book` entities from the database and returns 
    them as a list.
    - `findById(Long id)`: Fetches a `Book` with the given primary key and 
    returns it wrapped in an `Optional`
    - `save(Book book)`: Persists a new `Book` or updates an existing one 
    depending on whether its identifier already exists.
    - `deleteById(Long id)`: Removes the `Book` entity with the specified 
    primary key from the database.
    - `existsById(Long id)`: Checks whether a `Book` entity with the given 
    primary key exists in the database.
    - `count()`: Returns the total number of `Book` entities stored in the 
    database.

    These operations map directly to SQL operations like `SELECT`, 
    `INSERT`, `UPDATE`, and `DELETE`.


### REST Controller

This `BookController` is a Spring Boot REST controller that exposes a 
JPA-backed CRUD API for Book entities.

```Java
@RestController
@RequestMapping("/api/books")
public class BookController
{
    @Autowired
    private BookRepository bookRepository;

    //...
}
```

* **@RestController** marks the class as a REST endpoint provider and 
    automatically serializes return values to JSON.

* **@RequestMapping("/api/books")** defines the base URL for all endpoints 
    in this controller.

* **@Autowired**: Injects the Spring Data JPA repository that handles 
    database access for `Book` entities.



*Egon Teiniker, 2016 - 2026, GPL v3.0*
